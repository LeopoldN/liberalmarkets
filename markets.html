<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Liberal Markets — Minimal Finance Notes</title>
  <link rel="icon" type="image/svg+xml" href="assets/liberalmarketslogo.svg">
  <meta name="description" content="Minimalist finance blog with wireframe iconography and calm, earthy palette." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="styles.css?v=5" />
  <style>
    /* Heatmap: same “wireframe card” vibe, just… colored by reality */
    .hmSection {
      margin-top: 18px;
      padding: 18px;
      border-radius: 12px;
      border: 1px solid rgba(86, 255, 168, .24);
      background:
        linear-gradient(180deg, rgba(10, 10, 10, .92), rgba(5, 5, 5, .94)),
        radial-gradient(circle at 15% 10%, rgba(86, 255, 168, .08), transparent 45%);
      box-shadow: 0 14px 36px rgba(0, 0, 0, .45);
      position: relative;
      overflow: hidden;
    }
    .hmSection::before{
      content:"";
      position:absolute;
      inset: -40% -10%;
      background:
        repeating-linear-gradient(0deg, rgba(86, 255, 168, .06) 0 1px, transparent 1px 18px),
        repeating-linear-gradient(90deg, rgba(86, 255, 168, .05) 0 1px, transparent 1px 22px);
      opacity: .35;
      pointer-events: none;
    }
    .hmHead {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 12px;
    }
    .hmKicker {
      font-size: 11px;
      letter-spacing: .24em;
      text-transform: uppercase;
      opacity: .75;
    }
    .hmTitle {
      margin: 6px 0 6px;
      font-size: 22px;
      line-height: 1.15;
      text-transform: uppercase;
      letter-spacing: .08em;
    }
    .hmSub {
      margin: 0;
      max-width: 70ch;
      opacity: .8;
    }
    .hmActions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .hmStamp {
      font-size: 12px;
    }
    .hmGrid {
      display: grid;
      grid-template-columns: repeat(6, minmax(0, 1fr));
      gap: 10px;
    }
    @media (max-width: 1100px) {
      .hmGrid { grid-template-columns: repeat(4, minmax(0, 1fr)); }
    }
    @media (max-width: 720px) {
      .hmGrid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .hmHead { flex-direction: column; }
      .hmActions { justify-content: flex-start; }
    }
    .hmTile {
      position: relative;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(86, 255, 168, .18);
      background: rgba(8, 8, 8, .88);
      box-shadow:
        inset 0 0 0 1px rgba(86, 255, 168, .08),
        inset 0 12px 18px rgba(0, 0, 0, .28);
      cursor: pointer;
      text-align: left;
      min-height: 78px;
      display: grid;
      gap: 4px;
      transition: transform .12s ease, filter .12s ease, box-shadow .12s ease, border-color .12s ease;
    }

    /* Group accent bar (set via data-group in JS) */
    .hmTile::before {
      display: none;
    }

    .hmTile:hover {
      transform: translateY(-2px);
      filter: contrast(1.08) saturate(1.1);
      border-color: rgba(86, 255, 168, .35);
      box-shadow:
        inset 0 0 0 1px rgba(86, 255, 168, .12),
        0 14px 28px rgba(0,0,0,.45);
    }

    .hmTile:active { transform: translateY(-1px) scale(1.005); }

    .hmTile:focus-visible {
      outline: 2px solid rgba(86, 255, 168, .55);
      outline-offset: 2px;
    }

    /* Group accent colors */
    .hmTile[data-group="index"]  { --hmGroupBar: rgba(86, 255, 168, .55); }
    .hmTile[data-group="mega"]   { --hmGroupBar: rgba(86, 255, 168, .38); }
    .hmTile[data-group="large"]  { --hmGroupBar: rgba(86, 255, 168, .30); }
    .hmTile[data-group="sector"] { --hmGroupBar: rgba(86, 255, 168, .46); }
    .hmTile[data-group="macro"]  { --hmGroupBar: rgba(86, 255, 168, .26); }

    .hmSym {
      font-size: 10.5px;
      letter-spacing: .18em;
      text-transform: uppercase;
      opacity: .7;
    }
    .hmName {
      font-size: 14px;
      line-height: 1.2;
      font-weight: 600;
      opacity: .98;
    }
    .hmNums {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      margin-top: 2px;
    }
    .hmPct {
      font-variant-numeric: tabular-nums;
      font-weight: 700;
      font-size: 13px;
      letter-spacing: .02em;
    }
    .hmPct.is-up { color: rgba(86, 255, 168, .98); }
    .hmPct.is-dn { color: rgba(255, 98, 122, .95); }
    .hmPct.is-flat { color: rgba(230, 246, 239, .70); }
    .hmPx {
      font-variant-numeric: tabular-nums;
      opacity: .78;
      font-size: 11.5px;
      letter-spacing: .01em;
      padding-left: 10px;
      position: relative;
    }
    .hmPx::before {
    content: "·";
    position: absolute;
    left: 2px;
    top: 0;
    opacity: .55;
    }
    .hmTag {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 10px;
      letter-spacing: .12em;
      text-transform: uppercase;
      opacity: .75;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(86, 255, 168, .24);
      background: rgba(6, 6, 6, .7);
    }

    /* Color bands (subtle, not Vegas). */
    .hmDn3 { background: rgba(255, 98, 122, .26); }
    .hmDn2 { background: rgba(255, 98, 122, .18); }
    .hmDn1 { background: rgba(255, 98, 122, .12); }
    .hmFlat { background: rgba(10, 10, 10, .45); }
    .hmUp1 { background: rgba(86, 255, 168, .12); }
    .hmUp2 { background: rgba(86, 255, 168, .18); }
    .hmUp3 { background: rgba(86, 255, 168, .26); }

    .hmLegend {
      margin-top: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 12px;
      opacity: .85;
    }
    .hmSwatch {
      width: 14px;
      height: 10px;
      border-radius: 3px;
      border: 1px solid rgba(86, 255, 168, .18);
      display: inline-block;
      vertical-align: middle;
    }

    .terminalHead {
      margin-top: 10px;
      padding: 14px 16px;
      border-radius: 12px;
      border: 1px solid rgba(86, 255, 168, .28);
      background: rgba(8, 8, 8, .92);
      box-shadow: 0 16px 36px rgba(0, 0, 0, .5);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 18px;
      position: relative;
      overflow: hidden;
    }
    .terminalHead::before {
      content: "";
      position: absolute;
      inset: -40% -10%;
      background:
        repeating-linear-gradient(0deg, rgba(86, 255, 168, .05) 0 1px, transparent 1px 18px),
        repeating-linear-gradient(90deg, rgba(86, 255, 168, .04) 0 1px, transparent 1px 22px);
      opacity: .35;
      pointer-events: none;
    }
    .terminalTitle {
      font-size: 20px;
      text-transform: uppercase;
      letter-spacing: .22em;
    }
    .terminalMeta {
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 10.5px;
      letter-spacing: .16em;
      text-transform: uppercase;
      opacity: .78;
    }
    .statusDot {
      width: 8px;
      height: 8px;
      border-radius: 2px;
      border: 1px solid rgba(86, 255, 168, .6);
      background: rgba(86, 255, 168, .4);
      box-shadow: 0 0 12px rgba(86, 255, 168, .55);
      display: inline-block;
    }
    .terminalRight {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      position: relative;
      z-index: 1;
    }
    .kbdRow {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
    }
    .kbdKey {
      font-size: 10px;
      letter-spacing: .18em;
      text-transform: uppercase;
      padding: 5px 7px;
      border-radius: 6px;
      border: 1px solid rgba(86, 255, 168, .28);
      background: rgba(7, 7, 7, .9);
    }
    .terminalHint {
      font-size: 10px;
      letter-spacing: .2em;
      text-transform: uppercase;
      opacity: .6;
    }

    .tickerStrip {
      margin-top: 12px;
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid rgba(86, 255, 168, .24);
      background: rgba(7, 7, 7, .9);
      display: flex;
      align-items: center;
      gap: 12px;
      overflow: hidden;
    }
    .tickerLabel {
      font-size: 10px;
      letter-spacing: .28em;
      text-transform: uppercase;
      color: rgba(86, 255, 168, .9);
    }
    .tickerMarquee {
      display: flex;
      gap: 12px;
      overflow: hidden;
      flex: 1;
      padding-bottom: 2px;
    }
    .tickerTrack {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-shrink: 0;
      width: max-content;
      animation: ticker-scroll 42s linear infinite;
      padding-right: 12px;
    }
    .tickerStrip:hover .tickerTrack{
      animation-play-state: paused;
    }
    .tickerItem {
      display: flex;
      align-items: baseline;
      gap: 8px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid rgba(86, 255, 168, .2);
      background: rgba(8, 8, 8, .85);
      white-space: nowrap;
    }
    .tickerSym {
      font-size: 10px;
      letter-spacing: .18em;
      text-transform: uppercase;
      opacity: .75;
    }
    .tickerPx {
      font-variant-numeric: tabular-nums;
      font-size: 12px;
    }
    .tickerChg {
      font-variant-numeric: tabular-nums;
      font-size: 11px;
    }
    .tickerChg.is-up { color: rgba(86, 255, 168, .98); }
    .tickerChg.is-dn { color: rgba(255, 98, 122, .95); }
    .tickerChg.is-flat { color: rgba(230, 246, 239, .7); }

    .newsTicker {
      margin-top: 10px;
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid rgba(86, 255, 168, .24);
      background: rgba(7, 7, 7, .92);
      display: flex;
      align-items: center;
      gap: 12px;
      overflow: hidden;
    }
    .newsLabel {
      font-size: 10px;
      letter-spacing: .28em;
      text-transform: uppercase;
      color: rgba(86, 255, 168, .9);
    }
    .newsMarquee {
      display: flex;
      gap: 16px;
      overflow: hidden;
      flex: 1;
    }
    .newsTrack {
      display: flex;
      gap: 18px;
      flex-shrink: 0;
      width: max-content;
      animation: news-scroll 90s linear infinite;
      padding-right: 18px;
    }
    .newsTicker:hover .newsTrack{
      animation-play-state: paused;
    }
    .newsItem {
      font-size: 10px;
      letter-spacing: .12em;
      text-transform: uppercase;
      opacity: .72;
      white-space: nowrap;
      color: inherit;
      text-decoration: none;
    }
    .newsItem:hover{
      text-decoration: underline;
      text-underline-offset: 3px;
    }

    .signalGrid {
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 12px;
    }
    .signalCard {
      border-radius: 10px;
      border: 1px solid rgba(86, 255, 168, .22);
      background: rgba(8, 8, 8, .9);
      padding: 10px 12px;
      position: relative;
      overflow: hidden;
    }
    .signalCard::after{
      content:"";
      position:absolute;
      left: 10px;
      right: 10px;
      top: 0;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(86, 255, 168, .85), rgba(17, 207, 162, .6), transparent);
      opacity: .8;
    }
    .signalLabel {
      font-size: 10px;
      letter-spacing: .2em;
      text-transform: uppercase;
      opacity: .7;
    }
    .signalValue {
      margin-top: 8px;
      font-size: 18px;
      letter-spacing: .06em;
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }
    .signalMeta {
      margin-top: 6px;
      font-size: 10px;
      letter-spacing: .18em;
      text-transform: uppercase;
      opacity: .65;
    }
    .signalList {
      margin-top: 8px;
      display: grid;
      gap: 6px;
    }
    .signalRow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 11px;
    }
    .signalKey {
      letter-spacing: .16em;
      text-transform: uppercase;
      opacity: .6;
    }
    .signalVal {
      font-variant-numeric: tabular-nums;
    }

    .terminalTables {
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
    .terminalLayout {
      margin-top: 14px;
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 16px;
      align-items: start;
    }
    .terminalMain {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .terminalRail {
      position: sticky;
      top: 86px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      height: fit-content;
    }
    .railBlock {
      border-radius: 10px;
      border: 1px solid rgba(86, 255, 168, .22);
      background: rgba(8, 8, 8, .92);
      padding: 10px 12px;
    }
    .railHead {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      padding-bottom: 8px;
      border-bottom: 1px dashed rgba(86, 255, 168, .28);
      margin-bottom: 8px;
    }
    .railTitleSmall {
      font-size: 11px;
      letter-spacing: .2em;
      text-transform: uppercase;
    }
    .railHint {
      font-size: 10px;
      letter-spacing: .16em;
      text-transform: uppercase;
      opacity: .6;
    }
    .railList {
      display: grid;
      gap: 6px;
    }
    .railRow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 11px;
    }
    .railSym {
      letter-spacing: .18em;
      text-transform: uppercase;
      opacity: .8;
    }
    .railPx {
      font-variant-numeric: tabular-nums;
    }
    .railChg {
      font-variant-numeric: tabular-nums;
    }
    .railChg.is-up { color: rgba(86, 255, 168, .98); }
    .railChg.is-dn { color: rgba(255, 98, 122, .95); }
    .railChg.is-flat { color: rgba(230, 246, 239, .7); }
    .railEvent {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
    }
    .railTime {
      letter-spacing: .12em;
      text-transform: uppercase;
      opacity: .7;
    }
    .railEventText {
      opacity: .8;
    }
    .railAlert {
      font-size: 11px;
      opacity: .75;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px dashed rgba(86, 255, 168, .22);
      background: rgba(6, 6, 6, .7);
    }

    .marketBoard {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 12px;
    }
    .boardCard {
      border-radius: 10px;
      border: 1px solid rgba(86, 255, 168, .22);
      background: rgba(8, 8, 8, .9);
      padding: 10px 12px;
    }
    .boardHead {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      padding-bottom: 8px;
      border-bottom: 1px dashed rgba(86, 255, 168, .28);
      margin-bottom: 8px;
    }
    .boardTitle {
      font-size: 11px;
      letter-spacing: .2em;
      text-transform: uppercase;
    }
    .boardHint {
      font-size: 10px;
      letter-spacing: .16em;
      text-transform: uppercase;
      opacity: .6;
    }
    .boardRows {
      display: grid;
      gap: 6px;
    }
    .boardRow {
      display: grid;
      grid-template-columns: auto 1fr auto auto;
      gap: 8px;
      align-items: center;
      font-size: 11px;
    }
    .boardSym {
      letter-spacing: .18em;
      text-transform: uppercase;
      opacity: .8;
    }
    .boardName {
      opacity: .7;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .boardPx,
    .boardChg {
      font-variant-numeric: tabular-nums;
      text-align: right;
    }
    .boardChg.is-up { color: rgba(86, 255, 168, .98); }
    .boardChg.is-dn { color: rgba(255, 98, 122, .95); }
    .boardChg.is-flat { color: rgba(230, 246, 239, .7); }
    .moverGrid {
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }
    .moverList {
      display: grid;
      gap: 6px;
    }
    .moverRow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 11px;
      padding: 4px 0;
      border-bottom: 1px dashed rgba(86, 255, 168, .18);
    }
    .moverRow:last-child { border-bottom: 0; }
    .moverSym {
      letter-spacing: .16em;
      text-transform: uppercase;
      opacity: .75;
    }
    .moverName {
      flex: 1;
      margin-left: 8px;
      opacity: .7;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .moverPct {
      font-variant-numeric: tabular-nums;
    }
    .moverPct.is-up { color: rgba(86, 255, 168, .98); }
    .moverPct.is-dn { color: rgba(255, 98, 122, .95); }
    .moverPct.is-flat { color: rgba(230, 246, 239, .7); }
    .termTable {
      border-radius: 10px;
      border: 1px solid rgba(86, 255, 168, .22);
      background: rgba(8, 8, 8, .92);
      padding: 10px 12px;
    }
    .termTableHead {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      padding-bottom: 8px;
      border-bottom: 1px dashed rgba(86, 255, 168, .28);
      margin-bottom: 8px;
    }
    .termTableTitle {
      font-size: 11px;
      letter-spacing: .2em;
      text-transform: uppercase;
    }
    .termTableHint {
      font-size: 10px;
      letter-spacing: .16em;
      text-transform: uppercase;
      opacity: .6;
    }
    .gridTable {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }
    .gridTable th,
    .gridTable td {
      padding: 6px 6px;
      border-bottom: 1px dashed rgba(86, 255, 168, .18);
    }
    .gridTable th {
      text-align: left;
      font-weight: 600;
      letter-spacing: .16em;
      text-transform: uppercase;
      opacity: .7;
      font-size: 10px;
    }
    .gridTable tbody tr:hover {
      background: rgba(86, 255, 168, .06);
    }
    .cellSym {
      letter-spacing: .16em;
      text-transform: uppercase;
    }
    .cellPx,
    .cellChg {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }
    .cellChg.is-up { color: rgba(86, 255, 168, .98); }
    .cellChg.is-dn { color: rgba(255, 98, 122, .95); }
    .cellChg.is-flat { color: rgba(230, 246, 239, .7); }

    @media (max-width: 1100px) {
      .terminalLayout { grid-template-columns: 1fr; }
      .terminalRail { position: static; }
      .signalGrid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .marketBoard { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .terminalTables { grid-template-columns: 1fr; }
      .moverGrid { grid-template-columns: 1fr; }
    }
    @media (max-width: 720px) {
      .terminalHead { flex-direction: column; align-items: flex-start; }
      .terminalRight { align-items: flex-start; }
      .kbdRow { justify-content: flex-start; }
      .signalGrid { grid-template-columns: 1fr; }
      .marketBoard { grid-template-columns: 1fr; }
    }

    @keyframes ticker-scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    @keyframes news-scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    @media (prefers-reduced-motion: reduce) {
      .tickerTrack,
      .newsTrack{
        animation: none;
      }
    }
  </style>
</head>

<body class="markets">
  <a class="skip" href="#main">Skip to content</a>

  <header class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <!-- Liberal Markets logo -->
        <svg viewBox="0 0 1200 1200" xmlns="http://www.w3.org/2000/svg">
        <path d="m655.45 328.74v77.062-0.046875c0 9.375-7.5469 16.969-16.922 16.969h-77.062c-4.5 0-8.8125-1.7812-11.953-4.9688-3.1875-3.1875-4.9688-7.5-4.9688-12v-77.016c0-4.5 1.7812-8.8125 4.9688-12 3.1406-3.1875 7.4531-4.9688 11.953-4.9688h77.062c9.375 0 16.922 7.5938 16.922 16.969zm-279.94 0v77.062-0.046875c0 4.5-1.7812 8.8125-4.9688 12-3.1406 3.1875-7.4531 4.9688-11.953 4.9688h-78.656c-4.4531 0-8.7656-1.7812-11.953-4.9688s-4.9688-7.5-4.9219-12v-77.016c-0.046875-4.5 1.7344-8.8125 4.9219-12s7.5-4.9688 11.953-4.9688h78.656c4.5 0 8.8125 1.7812 11.953 4.9688 3.1875 3.1875 4.9688 7.5 4.9688 12zm488.29-99.094v-78.656c0-4.5 1.7812-8.7656 4.9219-11.953 3.1875-3.1875 7.5-4.9688 12-4.9688h215.44c9.375 0 16.922 7.5938 16.922 16.922v898.03c0 9.3281-7.5469 16.922-16.922 16.922h-215.44c-4.5 0-8.8125-1.7812-12-4.9688-3.1406-3.1875-4.9219-7.4531-4.9219-11.953v-77.016c0-9.3281 7.5469-16.922 16.922-16.922h119.91v-708.52h-119.91c-9.375 0-16.922-7.5938-16.922-16.922zm-664.45 725.39v-708.47h119.91c9.375 0 16.922-7.5938 16.922-16.922v-78.656c0-4.5-1.7812-8.7656-4.9219-11.953-3.1875-3.1875-7.5-4.9688-12-4.9688h-215.44c-9.375 0-16.922 7.5938-16.922 16.922v898.03c0 9.3281 7.5469 16.922 16.922 16.922h215.44c4.5 0 8.8125-1.7812 12-4.9688 3.1406-3.1875 4.9219-7.4531 4.9219-11.953v-77.016c0-9.3281-7.5469-16.922-16.922-16.922zm737.58-160.78 0.046875-0.046875c0-9.3281-7.5938-16.922-16.922-16.922h-78.656c-9.3281 0-16.922 7.5938-16.922 16.922v78.609c0 9.375 7.5938 16.922 16.922 16.969h78.656c9.3281 0 16.922-7.5938 16.922-16.969v-78.562zm-281.53 0v78.609l0.046875-0.046875c0 9.375-7.5469 16.969-16.922 16.969h-77.062c-4.5 0-8.8125-1.7812-11.953-4.9688-3.1875-3.1875-4.9688-7.5-4.9688-12v-78.562c0-4.5 1.7812-8.8125 4.9688-12 3.1406-3.1875 7.4531-4.9688 11.953-4.9688h77.062c9.375 0 16.922 7.5938 16.922 16.969zm-279.94 0v78.609l0.046875-0.046875c0 4.5-1.7812 8.8125-4.9688 12-3.1406 3.1875-7.4531 4.9688-11.953 4.9688h-78.656c-4.4531 0-8.7656-1.7812-11.953-4.9688s-4.9688-7.5-4.9219-12v-78.562c-0.046875-4.5 1.7344-8.8125 4.9219-12s7.5-4.9688 11.953-4.9688h78.656c4.5 0 8.8125 1.7812 11.953 4.9688 3.1875 3.1875 4.9688 7.5 4.9688 12zm561.47-232.78 0.046875-0.046874c0-4.5-1.7812-8.8125-4.9688-12-3.1875-3.1406-7.5-4.9219-11.953-4.9219h-78.656c-9.3281 0-16.922 7.5469-16.922 16.922v78.656-0.046876c0 9.375 7.5938 16.922 16.922 16.922h78.656c4.4531 0 8.7656-1.7812 11.953-4.9219 3.1875-3.1875 4.9688-7.5 4.9688-12v-78.562zm-281.53 0v78.656l0.046875-0.09375c0 4.5-1.7812 8.8125-4.9688 12-3.1406 3.1406-7.4531 4.9219-11.953 4.9219h-77.062c-9.3281 0-16.922-7.5469-16.922-16.922v-78.562c0-9.3281 7.5938-16.922 16.922-16.922h77.062c4.5 0 8.8125 1.7812 11.953 4.9688 3.1875 3.1406 4.9688 7.4531 4.9688 11.953zm-279.94 0v78.656l0.046875-0.09375c0 9.375-7.5938 16.922-16.922 16.922h-78.656c-9.3281 0-16.875-7.5469-16.875-16.922v-78.562c0-9.3281 7.5469-16.922 16.875-16.922h78.656c9.3281 0 16.922 7.5938 16.922 16.922zm561.47-232.78 0.046875-0.09375c0-9.3281-7.5938-16.922-16.922-16.922h-78.656c-9.3281 0-16.922 7.5938-16.922 16.922v77.062c0 9.3281 7.5938 16.922 16.922 16.922h78.656c9.3281 0 16.922-7.5469 16.922-16.922z" fill-rule="evenodd"/>
        </svg>
      </div>
      <div class="brandText">
        <div class="brandName">Liberal Markets</div>
        <div class="brandTag">market heatmap</div>
      </div>
    </div>

    <nav class="nav">
      <button class="chip" data-nav="all" type="button" aria-pressed="false">
        <span class="chipDot" aria-hidden="true"></span> Home
      </button>
      <button class="chip" data-nav="trumptracker" type="button" aria-pressed="false">
        <span class="chipDot" aria-hidden="true"></span> Trump Tracker
      </button>
      <button class="chip is-active" data-nav="markets" type="button" aria-pressed="true">
        <span class="chipDot" aria-hidden="true"></span> Markets
      </button>
      <button class="chip" data-nav="model" type="button" aria-pressed="false">
        <span class="chipDot" aria-hidden="true"></span> Model
      </button>
    </nav>

    <div class="actions">
      <label class="search" aria-label="Search posts">
        <span class="searchIcon" aria-hidden="true">
          <svg viewBox="0 0 24 24" class="icon" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="7"></circle>
            <path d="M20 20l-3.2-3.2"></path>
          </svg>
        </span>
        <input id="q" type="search" placeholder="Search… (e.g., “yield”, “CPI”, “DCF”)" autocomplete="off" />
        <span class="kbd" aria-hidden="true">⌘+K</span>
      </label>

    </div>
  </header>

  <main id="main" class="wrap">
    <section class="terminalHead" aria-label="Terminal header">
      <div>
        <div class="terminalTitle">Markets Terminal</div>
        <div class="terminalMeta">
          <span class="statusDot" aria-hidden="true"></span>
          <span>Session: Global</span>
          <span>UTC <span id="termUtc">—</span></span>
          <span>Local <span id="termLocal">—</span></span>
          <span>Sync <span id="termSync">—</span></span>
        </div>
      </div>
      <div class="terminalRight">
        <div class="kbdRow" aria-label="Terminal shortcuts">
          <span class="kbdKey">F1 Index</span>
          <span class="kbdKey">F2 Mega</span>
          <span class="kbdKey">F3 Large</span>
          <span class="kbdKey">F4 Sector</span>
          <span class="kbdKey">F5 Macro</span>
          <span class="kbdKey">F6 Reset</span>
        </div>
        <div class="terminalHint">Cmd + K to filter</div>
      </div>
    </section>

    <section class="tickerStrip" aria-label="Market ticker">
      <div class="tickerLabel">TAPE</div>
      <div class="tickerMarquee" role="list">
        <div class="tickerTrack">
          <div class="tickerItem" role="listitem" data-sym="spy.us">
            <span class="tickerSym">SPY</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" role="listitem" data-sym="qqq.us">
            <span class="tickerSym">QQQ</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" role="listitem" data-sym="dia.us">
            <span class="tickerSym">DIA</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" role="listitem" data-sym="10yusy.b">
            <span class="tickerSym">10Y</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" role="listitem" data-sym="usdeur">
            <span class="tickerSym">EURUSD</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" role="listitem" data-sym="cb.f">
            <span class="tickerSym">BRENT</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" role="listitem" data-sym="xauusd">
            <span class="tickerSym">GOLD</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" role="listitem" data-sym="btc.v">
            <span class="tickerSym">BTC</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
        </div>
        <div class="tickerTrack" aria-hidden="true">
          <div class="tickerItem" data-sym="spy.us">
            <span class="tickerSym">SPY</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" data-sym="qqq.us">
            <span class="tickerSym">QQQ</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" data-sym="dia.us">
            <span class="tickerSym">DIA</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" data-sym="10yusy.b">
            <span class="tickerSym">10Y</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" data-sym="usdeur">
            <span class="tickerSym">EURUSD</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" data-sym="cb.f">
            <span class="tickerSym">BRENT</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" data-sym="xauusd">
            <span class="tickerSym">GOLD</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
          <div class="tickerItem" data-sym="btc.v">
            <span class="tickerSym">BTC</span>
            <span class="tickerPx js-price">—</span>
            <span class="tickerChg js-pct is-flat">—</span>
          </div>
        </div>
      </div>
    </section>

    <section class="newsTicker" aria-label="News ticker">
      <div class="newsLabel">NEWS</div>
      <div class="newsMarquee">
        <div class="newsTrack" id="newsTrack">
          <span class="newsItem">Loading headlines…</span>
        </div>
        <div class="newsTrack" id="newsTrackClone" aria-hidden="true">
          <span class="newsItem">Loading headlines…</span>
        </div>
      </div>
    </section>

    <div class="terminalLayout">
      <div class="terminalMain">
        <section class="signalGrid" aria-label="Market signals">
      <div class="signalCard">
        <div class="signalLabel">Breadth</div>
        <div class="signalValue" id="sigBreadth">—</div>
        <div class="signalMeta"><span id="sigAdv">—</span> adv / <span id="sigDec">—</span> dec</div>
      </div>
      <div class="signalCard">
        <div class="signalLabel">Median Move</div>
        <div class="signalValue" id="sigMedian">—</div>
        <div class="signalMeta">Across symbols</div>
      </div>
      <div class="signalCard">
        <div class="signalLabel">Dispersion</div>
        <div class="signalValue" id="sigDisp">—</div>
        <div class="signalMeta">Std dev</div>
      </div>
      <div class="signalCard">
        <div class="signalLabel">Leaders</div>
        <div class="signalList">
          <div class="signalRow">
            <span class="signalKey">Top Up</span>
            <span class="signalVal" id="sigTopUp">—</span>
          </div>
          <div class="signalRow">
            <span class="signalKey">Top Dn</span>
            <span class="signalVal" id="sigTopDn">—</span>
          </div>
        </div>
        <div class="signalMeta">Heatmap</div>
      </div>
        </section>

        <section class="marketBoard" aria-label="Market board">
          <div class="boardCard">
            <div class="boardHead">
              <div class="boardTitle">Indices</div>
              <div class="boardHint">Global</div>
            </div>
            <div class="boardRows">
              <div class="boardRow" data-sym="spy.us">
                <span class="boardSym">SPY</span>
                <span class="boardName">S&amp;P 500</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="qqq.us">
                <span class="boardSym">QQQ</span>
                <span class="boardName">Nasdaq 100</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="^dax">
                <span class="boardSym">DAX</span>
                <span class="boardName">Germany</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="^ukx">
                <span class="boardSym">FTSE</span>
                <span class="boardName">UK 100</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
            </div>
          </div>
          <div class="boardCard">
            <div class="boardHead">
              <div class="boardTitle">Rates</div>
              <div class="boardHint">Govt</div>
            </div>
            <div class="boardRows">
              <div class="boardRow" data-sym="10yusy.b">
                <span class="boardSym">10Y</span>
                <span class="boardName">US 10Y</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="usdeur">
                <span class="boardSym">EUR</span>
                <span class="boardName">USD/EUR</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="^hsi">
                <span class="boardSym">HSI</span>
                <span class="boardName">Hong Kong</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="^nkx">
                <span class="boardSym">NKX</span>
                <span class="boardName">Japan</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
            </div>
          </div>
          <div class="boardCard">
            <div class="boardHead">
              <div class="boardTitle">Commodities</div>
              <div class="boardHint">Energy/Metals</div>
            </div>
            <div class="boardRows">
              <div class="boardRow" data-sym="cb.f">
                <span class="boardSym">BRENT</span>
                <span class="boardName">Oil</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="xauusd">
                <span class="boardSym">XAU</span>
                <span class="boardName">Gold</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="si.f">
                <span class="boardSym">SI</span>
                <span class="boardName">Silver</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="hg.f">
                <span class="boardSym">HG</span>
                <span class="boardName">Copper</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
            </div>
          </div>
          <div class="boardCard">
            <div class="boardHead">
              <div class="boardTitle">Crypto</div>
              <div class="boardHint">24h</div>
            </div>
            <div class="boardRows">
              <div class="boardRow" data-sym="btc.v">
                <span class="boardSym">BTC</span>
                <span class="boardName">Bitcoin</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="ung.us">
                <span class="boardSym">UNG</span>
                <span class="boardName">Nat Gas</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="slx.us">
                <span class="boardSym">SLX</span>
                <span class="boardName">Steel</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
              <div class="boardRow" data-sym="iwm.us">
                <span class="boardSym">IWM</span>
                <span class="boardName">Small Caps</span>
                <span class="boardPx js-price">—</span>
                <span class="boardChg js-pct is-flat">—</span>
              </div>
            </div>
          </div>
        </section>

        <section class="moverGrid" aria-label="Top movers">
      <div class="termTable">
        <div class="termTableHead">
          <div class="termTableTitle">Top Gainers</div>
          <div class="termTableHint">Top 5</div>
        </div>
        <div class="moverList" id="gainersList"></div>
      </div>
      <div class="termTable">
        <div class="termTableHead">
          <div class="termTableTitle">Top Losers</div>
          <div class="termTableHint">Top 5</div>
        </div>
        <div class="moverList" id="losersList"></div>
      </div>
      <div class="termTable">
        <div class="termTableHead">
          <div class="termTableTitle">Most Volatile</div>
          <div class="termTableHint">Abs move</div>
        </div>
        <div class="moverList" id="volList"></div>
      </div>
        </section>

        <section class="terminalTables" aria-label="Market tables">
      <div class="termTable">
        <div class="termTableHead">
          <div class="termTableTitle">Major Indices</div>
          <div class="termTableHint">Close to close</div>
        </div>
        <table class="gridTable" role="table">
          <thead>
            <tr>
              <th>Sym</th>
              <th>Name</th>
              <th class="cellPx">Last</th>
              <th class="cellChg">Chg%</th>
            </tr>
          </thead>
          <tbody>
            <tr data-sym="spy.us">
              <td class="cellSym">SPY</td>
              <td>S&amp;P 500</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="qqq.us">
              <td class="cellSym">QQQ</td>
              <td>Nasdaq 100</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="iwm.us">
              <td class="cellSym">IWM</td>
              <td>Russell 2000</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="dia.us">
              <td class="cellSym">DIA</td>
              <td>Dow 30</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="^dax">
              <td class="cellSym">DAX</td>
              <td>Germany</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="^ukx">
              <td class="cellSym">FTSE</td>
              <td>UK 100</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="termTable">
        <div class="termTableHead">
          <div class="termTableTitle">Macro</div>
          <div class="termTableHint">Cross asset</div>
        </div>
        <table class="gridTable" role="table">
          <thead>
            <tr>
              <th>Sym</th>
              <th>Name</th>
              <th class="cellPx">Last</th>
              <th class="cellChg">Chg%</th>
            </tr>
          </thead>
          <tbody>
            <tr data-sym="10yusy.b">
              <td class="cellSym">10Y</td>
              <td>US 10Y</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="usdeur">
              <td class="cellSym">EURUSD</td>
              <td>USD/EUR</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="cb.f">
              <td class="cellSym">BRENT</td>
              <td>Brent Oil</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="xauusd">
              <td class="cellSym">GOLD</td>
              <td>Gold</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="si.f">
              <td class="cellSym">SILVER</td>
              <td>Silver</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="btc.v">
              <td class="cellSym">BTC</td>
              <td>Bitcoin</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="termTable">
        <div class="termTableHead">
          <div class="termTableTitle">Mega Caps</div>
          <div class="termTableHint">Close to close</div>
        </div>
        <table class="gridTable" role="table">
          <thead>
            <tr>
              <th>Sym</th>
              <th>Name</th>
              <th class="cellPx">Last</th>
              <th class="cellChg">Chg%</th>
            </tr>
          </thead>
          <tbody>
            <tr data-sym="aapl.us">
              <td class="cellSym">AAPL</td>
              <td>Apple</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="msft.us">
              <td class="cellSym">MSFT</td>
              <td>Microsoft</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="nvda.us">
              <td class="cellSym">NVDA</td>
              <td>Nvidia</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="amzn.us">
              <td class="cellSym">AMZN</td>
              <td>Amazon</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="googl.us">
              <td class="cellSym">GOOGL</td>
              <td>Alphabet</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="meta.us">
              <td class="cellSym">META</td>
              <td>Meta</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="termTable">
        <div class="termTableHead">
          <div class="termTableTitle">Sectors</div>
          <div class="termTableHint">SPDR</div>
        </div>
        <table class="gridTable" role="table">
          <thead>
            <tr>
              <th>Sym</th>
              <th>Name</th>
              <th class="cellPx">Last</th>
              <th class="cellChg">Chg%</th>
            </tr>
          </thead>
          <tbody>
            <tr data-sym="xlk.us">
              <td class="cellSym">XLK</td>
              <td>Tech</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="xlf.us">
              <td class="cellSym">XLF</td>
              <td>Financials</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="xle.us">
              <td class="cellSym">XLE</td>
              <td>Energy</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="xly.us">
              <td class="cellSym">XLY</td>
              <td>Consumer Disc</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="xlp.us">
              <td class="cellSym">XLP</td>
              <td>Staples</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
            <tr data-sym="xlv.us">
              <td class="cellSym">XLV</td>
              <td>Health Care</td>
              <td class="cellPx js-price">—</td>
              <td class="cellChg js-pct is-flat">—</td>
            </tr>
          </tbody>
        </table>
      </div>
        </section>

        <section class="hmSection" aria-label="Stock heatmap">
      <div class="hmHead">
        <div>
          <div class="hmKicker">MARKETS</div>
          <h2 class="hmTitle">Stock heatmap</h2>
          <p class="hmSub">Daily close-to-close moves, sourced from Stooq. Equal-size tiles because market-cap math on the client is how you get bugs and ulcers.</p>
        </div>

        <div class="hmActions">
          <button class="btn" id="hmRefresh" type="button" title="Refresh heatmap">Refresh</button>
          <span class="hmStamp muted" id="hmStamp">Updated: —</span>
        </div>
      </div>

      <div class="hmGrid" id="hmGrid" role="list" aria-label="Heatmap tiles"></div>

      <div class="hmLegend" aria-label="Legend">
        <span class="muted">Legend:</span>
        <span><span class="hmSwatch hmDn3"></span> down big</span>
        <span><span class="hmSwatch hmDn2"></span> down</span>
        <span><span class="hmSwatch hmDn1"></span> slightly down</span>
        <span><span class="hmSwatch hmFlat"></span> flat</span>
        <span><span class="hmSwatch hmUp1"></span> slightly up</span>
        <span><span class="hmSwatch hmUp2"></span> up</span>
        <span><span class="hmSwatch hmUp3"></span> up big</span>
      </div>
        </section>
      </div>
      
    </div>


    <footer class="footer">
      <div class="footerLeft">
        <span class="footMark" aria-hidden="true"></span>
        <span>Liberal Markets</span>
        <span class="muted">© <span id="year"></span></span>
      </div>
      <div class="footerRight">
        <a class="footLink" href="#" id="exportBtn">Export pins</a>
        <span class="muted">No trackers. No noise.</span>
      </div>
    </footer>
  </main>

  <dialog class="modal" id="modal">
    <form method="dialog" class="modalBox">
      <div class="modalHead">
        <div class="modalTitle">Quick Search</div>
        <button class="x" value="cancel" aria-label="Close">
          <svg viewBox="0 0 24 24" class="icon" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M6 6l12 12"></path>
            <path d="M18 6l-12 12"></path>
          </svg>
        </button>
      </div>

      <label class="modalSearch">
        <input id="modalQ" type="search" placeholder="Type to filter posts…" autocomplete="off" />
      </label>

      <div class="modalList" id="modalList"></div>

      <div class="modalFoot">
        <span class="muted">Enter opens. Esc closes. Humans remain complicated.</span>
      </div>
    </form>
  </dialog>

  <script src="app.js?v=4"></script>
  <script src="scripts/chart.js?v=4"></script>
  <script>
    /**
     * Heatmap renderer (reads /heatmap.json generated by scripts/fetch-tape.mjs).
     * No direct Stooq client fetch because CORS is a thing that exists to ruin your day.
     */
    (function () {


    /**
     * Decide how to decorate the numeric value based on Stooq symbol suffix.
     * - *.us -> USD ($)
     * - *.b  -> percent (%)
     * - otherwise -> plain number (no symbol)
     *
     * @param {string} sym
     * @param {number} value
     * @returns {string}
     */
    function formatValueBySym(sym, value) {
    if (!Number.isFinite(value)) return "—";

    const s = String(sym ?? "").trim().toLowerCase();

    if (s.endsWith(".us")) {
        return `$${fmtPx(value)}`;
    }

    if (s.includes("hsi")) {
        return `HK$${fmtPx(value)}`;
    }

    if (s.includes("nkx")) {
        return `¥${fmtPx(value)}`;
    }

    if (s.includes("snx")) {
        return `₹${fmtPx(value)}`;
    }

    if (s.includes("dax")) {
        return `€${fmtPx(value)}`;
    }

    if (s.includes("ukx")) {
        return `£${fmtPx(value)}`;
    }
    
    if (s.endsWith(".b")) {
        // yields/rates typically come as already “4.17” meaning 4.17%
        return `${fmtPx(value)}%`;
    }

    // everything else: no symbol
    return fmtPx(value);
    }


      const grid = document.getElementById("hmGrid");
      const stamp = document.getElementById("hmStamp");
      const btn = document.getElementById("hmRefresh");
      const searchInput = document.getElementById("q");
      const termUtc = document.getElementById("termUtc");
      const termLocal = document.getElementById("termLocal");
      const termSync = document.getElementById("termSync");

      const sigBreadth = document.getElementById("sigBreadth");
      const sigAdv = document.getElementById("sigAdv");
      const sigDec = document.getElementById("sigDec");
      const sigMedian = document.getElementById("sigMedian");
      const sigDisp = document.getElementById("sigDisp");
      const sigTopUp = document.getElementById("sigTopUp");
      const sigTopDn = document.getElementById("sigTopDn");
      const gainersList = document.getElementById("gainersList");
      const losersList = document.getElementById("losersList");
      const volList = document.getElementById("volList");
      const newsTrack = document.getElementById("newsTrack");
      const newsTrackClone = document.getElementById("newsTrackClone");

      if (!grid || !stamp || !btn) return;

      // Heatmap state so we can re-sort without re-fetching.
      const hmState = {
        baseItems: /** @type {Array<any>} */ ([]),
        generatedAt: /** @type {string|null} */ (null),
      };

      function fmtTime(date, timeZone) {
        if (!(date instanceof Date) || Number.isNaN(date.getTime())) return "—";
        try {
          const opts = {
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
            hour12: false,
          };
          if (timeZone) opts.timeZone = timeZone;
          return date.toLocaleTimeString("en-US", opts);
        } catch {
          return date.toTimeString().slice(0, 8);
        }
      }

      function updateClocks() {
        const now = new Date();
        if (termUtc) termUtc.textContent = fmtTime(now, "UTC");
        if (termLocal) termLocal.textContent = fmtTime(now);
      }

      function updateTermSync(ts) {
        if (!termSync) return;
        const d = ts ? new Date(ts) : null;
        termSync.textContent = d && !Number.isNaN(d.getTime()) ? fmtTime(d) : "—";
      }

      /**
       * Get the current query string from the top search box.
       * @returns {string}
       */
      function getHeatmapQuery() {
        return String(searchInput?.value ?? "").trim();
      }

      /**
       * Map percent change into a subtle color band.
       * @param {number} pct
       * @returns {string}
       */
      function bandClass(pct) {
        if (!Number.isFinite(pct)) return "hmFlat";
        if (pct <= -2.0) return "hmDn3";
        if (pct <= -1.0) return "hmDn2";
        if (pct <= -0.25) return "hmDn1";
        if (pct < 0.25) return "hmFlat";
        if (pct < 1.0) return "hmUp1";
        if (pct < 2.0) return "hmUp2";
        return "hmUp3";
      }

    function pctDirClass(pct) {
        if (!Number.isFinite(pct)) return "is-flat";
        if (pct > 0.05) return "is-up";
        if (pct < -0.05) return "is-dn";
        return "is-flat";
      }

      /**
       * Format a percent change.
       * @param {number} pct
       * @returns {string}
       */
      function fmtPct(pct) {
        if (!Number.isFinite(pct)) return "—";
        const sign = pct > 0 ? "+" : "";
        return `${sign}${pct.toFixed(2)}%`;
      }

      /**
       * Format price (keep it simple and readable).
       * @param {number} px
       * @returns {string}
       */
      function fmtPx(px) {
        if (!Number.isFinite(px)) return "—";
        if (Math.abs(px) >= 1000) return px.toFixed(0);
        if (Math.abs(px) >= 100) return px.toFixed(1);
        return px.toFixed(2);
      }

      function updateSymbolBindings(items) {
        if (!Array.isArray(items) || !items.length) return;
        const map = new Map();
        for (const it of items) {
          const key = String(it?.sym ?? "").trim().toLowerCase();
          if (key) map.set(key, it);
        }

        document.querySelectorAll("[data-sym]").forEach((node) => {
          const key = String(node.getAttribute("data-sym") ?? "").trim().toLowerCase();
          const it = map.get(key);
          if (!it) return;

          const pct = Number(it.deltaPct);
          const close = Number(it.close);
          const ok = it.ok !== false && Number.isFinite(pct) && Number.isFinite(close);

          const priceText = ok ? formatValueBySym(it.sym, close) : "—";
          const pctText = ok ? fmtPct(pct) : "—";

          node.querySelectorAll(".js-price").forEach((el) => {
            el.textContent = priceText;
          });
          node.querySelectorAll(".js-pct").forEach((el) => {
            el.textContent = pctText;
            el.classList.remove("is-up", "is-dn", "is-flat");
            el.classList.add(pctDirClass(pct));
          });
        });
      }

      function updateSignalBlocks(items) {
        if (!sigBreadth || !Array.isArray(items)) return;
        const deltas = items
          .map((it) => Number(it.deltaPct))
          .filter((v) => Number.isFinite(v))
          .sort((a, b) => a - b);

        if (!deltas.length) {
          sigBreadth.textContent = "—";
          if (sigAdv) sigAdv.textContent = "—";
          if (sigDec) sigDec.textContent = "—";
          if (sigMedian) sigMedian.textContent = "—";
          if (sigDisp) sigDisp.textContent = "—";
          if (sigTopUp) sigTopUp.textContent = "—";
          if (sigTopDn) sigTopDn.textContent = "—";
          return;
        }

        const adv = deltas.filter((v) => v > 0.05).length;
        const dec = deltas.filter((v) => v < -0.05).length;
        const active = adv + dec;
        const breadth = active ? (adv / active) * 100 : 0;

        const mid = Math.floor(deltas.length / 2);
        const median = deltas.length % 2 ? deltas[mid] : (deltas[mid - 1] + deltas[mid]) / 2;
        const mean = deltas.reduce((a, b) => a + b, 0) / deltas.length;
        const variance = deltas.reduce((a, b) => a + (b - mean) ** 2, 0) / deltas.length;
        const stdev = Math.sqrt(variance);

        let topUp = null;
        let topDn = null;
        for (const it of items) {
          const pct = Number(it.deltaPct);
          if (!Number.isFinite(pct)) continue;
          if (!topUp || pct > topUp.pct) topUp = { sym: it.sym, pct };
          if (!topDn || pct < topDn.pct) topDn = { sym: it.sym, pct };
        }

        sigBreadth.textContent = `${breadth.toFixed(0)}%`;
        if (sigAdv) sigAdv.textContent = String(adv);
        if (sigDec) sigDec.textContent = String(dec);
        if (sigMedian) sigMedian.textContent = fmtPct(median);
        if (sigDisp) sigDisp.textContent = `${stdev.toFixed(2)}%`;
        if (sigTopUp) sigTopUp.textContent = topUp ? `${String(topUp.sym ?? "").toUpperCase()} ${fmtPct(topUp.pct)}` : "—";
        if (sigTopDn) sigTopDn.textContent = topDn ? `${String(topDn.sym ?? "").toUpperCase()} ${fmtPct(topDn.pct)}` : "—";
      }

      function renderMoverList(el, rows) {
        if (!el) return;
        if (!rows.length) {
          el.innerHTML = "<div class=\"moverRow\"><span class=\"moverSym\">—</span><span class=\"moverName\">No data</span><span class=\"moverPct is-flat\">—</span></div>";
          return;
        }
        el.innerHTML = rows.map((row) => {
          const pctClass = pctDirClass(row.pct);
          return `
            <div class="moverRow">
              <span class="moverSym">${row.sym}</span>
              <span class="moverName">${row.name}</span>
              <span class="moverPct ${pctClass}">${fmtPct(row.pct)}</span>
            </div>
          `;
        }).join("");
      }

      function updateMoverLists(items) {
        if (!Array.isArray(items)) return;
        const usable = items
          .map((it) => ({
            sym: String(it.sym ?? "").toUpperCase(),
            name: String(it.name ?? it.sym ?? ""),
            pct: Number(it.deltaPct),
          }))
          .filter((it) => it.sym && Number.isFinite(it.pct));

        const gainers = [...usable].sort((a, b) => b.pct - a.pct).slice(0, 5);
        const losers = [...usable].sort((a, b) => a.pct - b.pct).slice(0, 5);
        const vol = [...usable].sort((a, b) => Math.abs(b.pct) - Math.abs(a.pct)).slice(0, 5);

        renderMoverList(gainersList, gainers);
        renderMoverList(losersList, losers);
        renderMoverList(volList, vol);
      }

      function escapeHtml(value) {
        return String(value ?? "")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/\"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function renderNews(items) {
        if (!newsTrack || !newsTrackClone) return;
        const cleaned = Array.isArray(items)
          ? items
              .map((it) => ({
                title: String(it?.title ?? "").trim(),
                link: String(it?.link ?? "").trim(),
              }))
              .filter((it) => it.title.length)
          : [];

        if (!cleaned.length) return;

        const html = cleaned
          .map((it) => {
            const title = escapeHtml(it.title);
            const link = it.link ? escapeHtml(it.link) : "";
            return link
              ? `<a class="newsItem" href="${link}" target="_blank" rel="noopener noreferrer">${title}</a>`
              : `<span class="newsItem">${title}</span>`;
          })
          .join("");

        newsTrack.innerHTML = html;
        newsTrackClone.innerHTML = html;
      }

      async function loadNews() {
        if (!newsTrack || !newsTrackClone) return;
        try {
          const res = await fetch(`data/news.json?v=${Date.now()}`, { cache: "no-store" });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const payload = await res.json();
          renderNews(payload?.items ?? []);
        } catch {
          // Keep placeholder text on failure.
        }
      }

      /**
       * Compute a match score for sorting.
       * Higher score = closer match.
       *
       * @param {any} it
       * @param {string[]} tokens
       * @returns {number}
       */
      function scoreItem(it, tokens) {
        if (!tokens.length) return 0;

        const sym = String(it?.sym ?? "").trim().toLowerCase();
        const name = String(it?.name ?? "").trim().toLowerCase();
        const group = String(it?.group ?? "").trim().toLowerCase();

        let score = 0;
        for (const t of tokens) {
          if (!t) continue;

          // Symbol: strongest signal
          if (sym === t) score += 40;
          else if (sym.startsWith(t)) score += 25;
          else if (sym.includes(t)) score += 12;

          // Name: medium signal
          if (name === t) score += 18;
          else if (name.startsWith(t)) score += 12;
          else if (name.includes(t)) score += 8;

          // Group: lighter signal (index/mega/sector/etc.)
          if (group === t) score += 10;
          else if (group.startsWith(t)) score += 7;
          else if (group.includes(t)) score += 4;
        }

        return score;
      }

      /**
       * Render heatmap tiles.
       * @param {Array<any>} items
       * @param {string|null} generatedAt
       */
      function renderTiles(items, generatedAt) {
        grid.innerHTML = "";

        for (const it of items) {
          const pct = Number(it.deltaPct);
          const close = Number(it.close);

          const tile = document.createElement("button");
          tile.type = "button";
          tile.className = `hmTile ${bandClass(pct)}`;
          tile.setAttribute("role", "listitem");
          tile.title = it.ok === false ? `Failed: ${it.error ?? "unknown"}` : "Open on Stooq";

          const symLabel = String(it.sym ?? "").toUpperCase();
          const group = it.group ? String(it.group) : "";
          const groupKey = group ? group.toLowerCase() : "";
          if (groupKey) tile.dataset.group = groupKey;

          tile.innerHTML = `
            <div class="hmSym">${symLabel}</div>
            <div class="hmName">${it.name ?? symLabel}</div>
            ${group ? `<div class="hmTag">${group}</div>` : ""}
            <div class="hmNums">
              <div class="hmPct ${it.ok === false ? "" : pctDirClass(pct)}">${it.ok === false ? "—" : fmtPct(pct)}</div>
              <div class="hmPx">${it.ok === false ? "" : formatValueBySym(it.sym, close)}</div>
            </div>
          `;

          tile.addEventListener("click", () => {
            const sym = encodeURIComponent(it.sym ?? "");
            if (!sym) return;
            window.open(`https://stooq.com/q/?s=${sym}`, "_blank", "noopener,noreferrer");
          });

          grid.appendChild(tile);
        }

        const ts = generatedAt ? new Date(generatedAt) : null;
        stamp.textContent = ts && !Number.isNaN(ts.getTime())
          ? `Updated: ${ts.toLocaleString()}`
          : "Updated: —";
      }

      /**
       * Apply the current query: sort items by symbol/name/group match.
       * We don't hide non-matches; we just push matches to the front.
       */
      function applyHeatmapQuery() {
        const q = getHeatmapQuery().toLowerCase();
        const tokens = q.split(/\s+/g).filter(Boolean);

        const base = Array.isArray(hmState.baseItems) ? hmState.baseItems : [];
        if (!base.length) {
          renderTiles([], hmState.generatedAt);
          return;
        }

        // Stable sort: use original index as tie-breaker.
        const ranked = base.map((it, idx) => ({ it, idx, score: scoreItem(it, tokens) }));

        ranked.sort((a, b) => {
          // If no query, keep original order.
          if (!tokens.length) return a.idx - b.idx;

          // Higher score first.
          if (b.score !== a.score) return b.score - a.score;

          // Tie-breaker: original order.
          return a.idx - b.idx;
        });

        renderTiles(ranked.map(r => r.it), hmState.generatedAt);
      }

      /**
       * Render heatmap from payload and preserve base ordering for stable re-sorts.
       * @param {{generatedAt:string, items:Array<any>}} payload
       */
      function render(payload) {
        const items = Array.isArray(payload?.items) ? payload.items : [];
        hmState.baseItems = items;
        hmState.generatedAt = payload?.generatedAt ?? null;
        applyHeatmapQuery();
        updateSymbolBindings(items);
        updateSignalBlocks(items);
        updateMoverLists(items);
        updateTermSync(hmState.generatedAt);
      }

      /**
       * Fetch heatmap.json from the same origin.
       */
      async function load() {
        grid.innerHTML = "";
        const skeleton = document.createElement("div");
        skeleton.className = "muted";
        skeleton.textContent = "Loading heatmap…";
        grid.appendChild(skeleton);

        try {
          const res = await fetch(`heatmap.json?v=${Date.now()}`, { cache: "no-store" });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const payload = await res.json();
          render(payload);
        } catch (e) {
          grid.innerHTML = "";
          const err = document.createElement("div");
          err.className = "muted";
          err.textContent = `Heatmap failed to load (${e instanceof Error ? e.message : String(e)}).`;
          grid.appendChild(err);
        }
      }

      btn.addEventListener("click", load);

      // Re-sort heatmap as the user types in the main search box.
      if (searchInput) {
        searchInput.addEventListener("input", () => {
          // If heatmap hasn't loaded yet, this is harmless.
          applyHeatmapQuery();
        });
      }

      updateClocks();
      setInterval(updateClocks, 1000);
      load();
      loadNews();
    })();
  </script>
</body>
</html>
